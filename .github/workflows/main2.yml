name: Release Workflow

on:
  workflow_dispatch:

jobs:
  get-latest-release-version:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Get latest release tag and extract version
      id: get-version
      run: |
        TAG=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          https://api.github.com/repos/${{ github.repository }}/releases/latest \
          | jq -r .tag_name)

        # Extract version using regular expression
        if [[ "$TAG" =~ (test|staging|production)_([0-9]+\.[0-9]+\.[0-9]+) ]]; then
          VERSION="${BASH_REMATCH[2]}"
        else
          echo "Failed to extract version from tag: $TAG"
          exit 1
        fi

        echo "Latest release version is $VERSION"
        echo "::set-output name=version::$VERSION"

  your-other-job:
    needs: get-latest-release-version
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Use the latest release version
      run: |
        echo "Using latest release version: ${{ needs.get-latest-release-version.outputs.version }}"
